<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting data by region • naturecounts</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Getting data by region">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">naturecounts</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/mapping-observations.html">Mapping Observations</a>
    </li>
    <li>
      <a href="../../articles/articles/region.html">Getting data by region</a>
    </li>
    <li>
      <a href="../../articles/filtering_data.html">Filtering data</a>
    </li>
    <li>
      <a href="../../articles/species-codes.html">Species Codes</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/BirdStudiesCanada/naturecounts">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Getting data by region</h1>
            
            <h4 class="date">2019-03-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/BirdStudiesCanada/naturecounts/blob/master/vignettes/articles/region.Rmd"><code>vignettes/articles/region.Rmd</code></a></small>
      <div class="hidden name"><code>region.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(naturecounts)</a></code></pre></div>
<p>In the main data download functions for <code>naturecounts</code>, <code><a href="../../reference/nc_data_dl.html">nc_data_dl()</a></code> and <code><a href="../../reference/nc_count.html">nc_count()</a></code>, you have the option of filtering data by <code>region</code>. In this article we will explore the various ways of specifying regional filters.</p>
<div id="in-short" class="section level2">
<h2 class="hasAnchor">
<a href="#in-short" class="anchor"></a>In short</h2>
<p><code>region</code> must be a named list with <strong>one</strong> of the following:</p>
<ul>
<li>
<code>country</code> - Country code (e.g., <code>CA</code> for Canada)</li>
<li>
<code>statprov</code> - State/province code (e.g., <code>MB</code> for Manitoba)</li>
<li>
<code>subnational2</code> - Subnational (type 2) code (e.g., <code>CA.MB.07</code> for the Brandon Area)</li>
<li>
<code>iba</code> - Important Bird Areas (IBA) code (e.g., <code>AB001</code> for Beaverhill Lake in Alberta)</li>
<li>
<code>bcr</code> - <a href="https://www.birdscanada.org/research/gislab/index.jsp?targetpg=bcr&amp;targetpg=bcr">Bird Conservation Regions</a> (e.g., <code>2</code> for Western Alaska)</li>
<li>
<code>utm_squares</code> - UTM square code (e.g., <code>10UFE96</code> for a grid in Alberta)</li>
<li>
<code>bbox</code> - Bounding box coordinates (e.g., <code><a href="https://www.rdocumentation.org/packages/base/topics/c">c(left = -101.097223, bottom = 50.494717, right = -99.511239, top = 51.027557)</a></code> for a box containing Riding Mountain National Park in Manitoba)</li>
</ul>
<p>To use the <code>region</code> argument:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="../../reference/nc_count.html">nc_count</a></span>(<span class="dt">region =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">bbox =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dt">left =</span> <span class="fl">-101.097223</span>, <span class="dt">bottom =</span> <span class="fl">50.494717</span>, </a>
<a class="sourceLine" id="cb2-2" data-line-number="2">                                <span class="dt">right =</span> <span class="fl">-99.511239</span>, <span class="dt">top =</span> <span class="fl">51.027557</span>)))</a></code></pre></div>
</div>
<div id="in-detail---codes" class="section level2">
<h2 class="hasAnchor">
<a href="#in-detail---codes" class="anchor"></a>In Detail - Codes</h2>
<div id="country" class="section level3">
<h3 class="hasAnchor">
<a href="#country" class="anchor"></a>Country</h3>
<p><strong>Search by name</strong> (English or French)</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="../../reference/region_search.html">region_search</a></span>(<span class="st">"États-Unis"</span>, <span class="dt">type =</span> <span class="st">"country"</span>)</a></code></pre></div>
<pre><code>##   country_code                         country_name                        country_name_fr
## 1           UM United States Minor Outlying Islands Îles mineures éloignées des États-Unis
## 2           US                        United States                             États-Unis
## 3           VI                 Virgin Uslands, U.S.            Îles Vierges des États-Unis</code></pre>
<p><strong>Browse the code list</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="../../reference/meta.html">meta_country_codes</a></span>()</a></code></pre></div>
<p><strong>Use the resulting code(s)</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../../reference/nc_count.html">nc_count</a></span>(<span class="dt">region =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">country =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"US"</span>, <span class="st">"CA"</span>)))</a></code></pre></div>
</div>
<div id="stateprovince" class="section level3">
<h3 class="hasAnchor">
<a href="#stateprovince" class="anchor"></a>State/Province</h3>
<p><strong>Search by name</strong> (English, French, or Spanish)</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="../../reference/region_search.html">region_search</a></span>(<span class="st">"Distrito de Colombia"</span>, <span class="dt">type =</span> <span class="st">"statprov"</span>)</a></code></pre></div>
<pre><code>##   country_code statprov_code     statprov_name_es        statprov_name     statprov_name_fr
## 1           US            DC Distrito de Colombia District of Columbia District de Columbia</code></pre>
<p><strong>Browse the code list</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="../../reference/meta.html">meta_statprov_codes</a></span>()</a></code></pre></div>
<p><strong>Use the resulting code(s)</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="../../reference/nc_count.html">nc_count</a></span>(<span class="dt">region =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">statprov =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"DC"</span>, <span class="st">"MB"</span>)))</a></code></pre></div>
</div>
<div id="subnational-regions-type-2" class="section level3">
<h3 class="hasAnchor">
<a href="#subnational-regions-type-2" class="anchor"></a>Subnational regions (type 2)</h3>
<p><strong>Search by name</strong><br>
Language depends on location: - Mexico = Spanish - USA = English - Quebec = French - Rest of Canada = English</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../../reference/region_search.html">region_search</a></span>(<span class="st">"Montreal"</span>, <span class="dt">type =</span> <span class="st">"subnational2"</span>)</a></code></pre></div>
<pre><code>##   country_code statprov_code subnational2_code              subnational2_name ebird_code
## 1           CA            QC          CA.QC.MR Communauté-Urbaine-de-Montréal   CA-QC-MR</code></pre>
<p><strong>Browse the code list</strong></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="../../reference/meta.html">meta_subnational2_codes</a></span>()</a></code></pre></div>
<p><strong>Use the resulting code(s)</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="../../reference/nc_count.html">nc_count</a></span>(<span class="dt">region =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">subnational2 =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"CA-QC-MR"</span>, <span class="st">"CA-ON-TO"</span>)))</a></code></pre></div>
</div>
<div id="important-bird-areas-iba" class="section level3">
<h3 class="hasAnchor">
<a href="#important-bird-areas-iba" class="anchor"></a>Important Bird Areas (IBA)</h3>
<ul>
<li>These are Canadian designations</li>
</ul>
<p><strong>Search by name</strong> (English or French)</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw"><a href="../../reference/region_search.html">region_search</a></span>(<span class="st">"oak hammock"</span>, <span class="dt">type =</span> <span class="st">"iba"</span>)</a></code></pre></div>
<pre><code>##   iba_code              iba_name status alt_max           iba_name_fr bcr_code    lon statprov area
## 1    MB010 Oak Hammock Marsh WMA      G     233 Oak Hammock Marsh WMA       11 -97.13       MB   36
##   nearest_town alt_min ncc_region   lat
## 1     Winnipeg     233         35 50.17</code></pre>
<p><strong>Browse the code list</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw"><a href="../../reference/meta.html">meta_iba_codes</a></span>()</a></code></pre></div>
<p><strong>Use the resulting code(s)</strong></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="../../reference/nc_count.html">nc_count</a></span>(<span class="dt">region =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">iba =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"MB010"</span>, <span class="st">"AB011"</span>)))</a></code></pre></div>
</div>
<div id="bird-conservation-regions-bcr" class="section level3">
<h3 class="hasAnchor">
<a href="#bird-conservation-regions-bcr" class="anchor"></a>Bird Conservation Regions (BCR)</h3>
<p><strong>Search by name</strong> (English, French, or Spanish)</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="../../reference/region_search.html">region_search</a></span>(<span class="st">"rainforest"</span>, <span class="dt">type =</span> <span class="st">"bcr"</span>)</a></code></pre></div>
<pre><code>##   bcr_code                    bcr_name                        bcr_name_es
## 1        5 Northern Pacific Rainforest Bosque Lluvioso del Pacífico Norte
##                                        bcr_name_fr
## 1 Forêts pluviales du nord de la côte du Pacifique</code></pre>
<p><strong>Browse the code list</strong></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="../../reference/meta.html">meta_bcr_codes</a></span>()</a></code></pre></div>
<p><strong>Use the resulting code(s)</strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="../../reference/nc_count.html">nc_count</a></span>(<span class="dt">region =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">bcr =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">5</span>, <span class="dv">2</span>)))</a></code></pre></div>
</div>
</div>
<div id="in-detail---exploring-regions" class="section level2">
<h2 class="hasAnchor">
<a href="#in-detail---exploring-regions" class="anchor"></a>In Detail - Exploring regions</h2>
<p>In this section we’ll go over how to use spatial data to more precisely define regional filters.</p>
<p>We’ll be using the <a href="http://tidyverse.org"><code>tidyverse</code></a> packages <code>dplyr</code> and <code>ggplot2</code> for data manipulation and plotting, respectively. We’ll use the <code>gridExtra</code> to combine figures. We’ll use the <code>sf</code> package for working with spatial data, and the <code>rnaturalearth</code> package to get example spatial data.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(gridExtra)</a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(sf)</a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(rnaturalearth)</a></code></pre></div>
<p>If you have your own spatial data files that you would like to read into R, we recommend reading the <a href="https://r-spatial.github.io/sf/articles/sf2.html">Reading, Writing and Converting Simple Features Vignette</a> from the <a href="https://r-spatial.github.io/sf/"><code>sf</code> website</a>.</p>
<p>First we’ll get some spatial objects for our explorations from the <code>rnaturalearth</code> package. A map of Canada and a map of Ontario, both transformed from CRS 4326 (unprojected lat/lon) to 3347 (NAD83 Statistics Canada).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">canada &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rnaturalearth/topics/ne_states">ne_states</a></span>(<span class="dt">country =</span> <span class="st">"canada"</span>, <span class="dt">returnclass =</span> <span class="st">"sf"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(<span class="dv">3347</span>)</a>
<a class="sourceLine" id="cb24-3" data-line-number="3"></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">ontario &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rnaturalearth/topics/ne_states">ne_states</a></span>(<span class="dt">country =</span> <span class="st">"Canada"</span>, <span class="dt">returnclass =</span> <span class="st">"sf"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(name <span class="op">==</span><span class="st"> "Ontario"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(<span class="dv">3347</span>)</a></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> canada) <span class="op">+</span><span class="st">                  </span><span class="co"># Map of Canada </span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> ontario, <span class="dt">fill =</span> <span class="st">"orange"</span>)  <span class="co"># Map of Ontario</span></a></code></pre></div>
<p><img src="region_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
<div id="important-bird-areas" class="section level3">
<h3 class="hasAnchor">
<a href="#important-bird-areas" class="anchor"></a>Important Bird Areas</h3>
<p>To get a visual idea of where different Important Bird Areas are, let’s plot them on our map of Canada.</p>
<p>First we need to grab the IBA data frame and convert it to a spatial object. Because the data contains lat/lon, we assign it to CRS 4326 for GPS lat/lon data, and then convert it to match the crs of our maps.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">iba &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/meta.html">meta_iba_codes</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_as_sf">st_as_sf</a></span>(<span class="dt">coords =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(<span class="dv">3347</span>)</a>
<a class="sourceLine" id="cb26-4" data-line-number="4"></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb26-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb26-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> canada) <span class="op">+</span></a>
<a class="sourceLine" id="cb26-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> iba)</a></code></pre></div>
<p><img src="region_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>If you want to narrow in on only one province, filter the map of Canada and the IBA data frame:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">yk &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(canada, gn_name <span class="op">==</span><span class="st"> "Yukon"</span>)</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">iba_yk &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(iba, statprov <span class="op">==</span><span class="st"> "YK"</span>)</a>
<a class="sourceLine" id="cb27-3" data-line-number="3"></a>
<a class="sourceLine" id="cb27-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb27-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb27-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> yk) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> iba_yk) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf_text</a></span>(<span class="dt">data =</span> iba_yk, <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">label =</span> iba_code), <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">vjust =</span> <span class="fl">-0.5</span>)</a></code></pre></div>
<p><img src="region_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
</div>
<div id="filtering-to-a-shape-file" class="section level3">
<h3 class="hasAnchor">
<a href="#filtering-to-a-shape-file" class="anchor"></a>Filtering to a shape file</h3>
<p>Often you might be interested only in observations which fall within a very specific geographic area. While the <code><a href="../../reference/nc_data_dl.html">nc_data_dl()</a></code> function cannot take a shapefile as an argument, you can use shape files to specify either the <code>utm_squares</code> or the <code>bbox</code> (bounding box) surrounding your area of interest. After the download, you can then trip the resulting observations to your original shape file.</p>
<div id="utm-squares" class="section level4">
<h4 class="hasAnchor">
<a href="#utm-squares" class="anchor"></a>UTM Squares</h4>
<p>In the following example, let’s assume that you wish to concentrate only on observations from <em>urban</em> areas in Ontario, Canada.</p>
<p>We’ll download that data with the <code>rnaturalearth</code> package and save it to the working directory (“.”)</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/rnaturalearth/topics/ne_download">ne_download</a></span>(<span class="dt">scale =</span> <span class="dv">10</span>, <span class="dt">type =</span> <span class="st">"urban_areas"</span>, <span class="dt">returnclass =</span> <span class="st">"sf"</span>, </a>
<a class="sourceLine" id="cb28-2" data-line-number="2">            <span class="dt">destdir =</span> <span class="st">"."</span>, <span class="dt">load =</span> <span class="ot">FALSE</span>) </a></code></pre></div>
<p>Now that we’ve saved it, we can load it for use.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">urban &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rnaturalearth/topics/ne_load">ne_load</a></span>(<span class="dt">scale =</span> <span class="dv">10</span>, <span class="dt">type =</span> <span class="st">"urban_areas"</span>, <span class="dt">returnclass =</span> <span class="st">"sf"</span>, </a>
<a class="sourceLine" id="cb29-2" data-line-number="2">                 <span class="dt">destdir =</span> <span class="st">"."</span>)</a></code></pre></div>
<pre><code>## OGR data source with driver: ESRI Shapefile 
## Source: "/home/steffi/Projects/Business/BSC/NatureCounts/naturecounts/vignettes/articles/region_files", layer: "ne_10m_urban_areas"
## with 11878 features
## It has 4 fields
## Integer64 fields read as strings:  scalerank</code></pre>
<p>First we’ll transform it to the 3347 CRS and filter it to contain only Ontario, but clipping it to our map of Ontario. <code><a href="https://www.rdocumentation.org/packages/sf/topics/st_join">st_join(spatial1, spatial2, left = FALSE)</a></code> means inner join, resulting in clipping.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">urban_ontario &lt;-<span class="st"> </span>urban <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(<span class="dv">3347</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_join">st_join</a></span>(ontario, <span class="dt">left =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb31-4" data-line-number="4"></a>
<a class="sourceLine" id="cb31-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb31-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb31-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> ontario) <span class="op">+</span></a>
<a class="sourceLine" id="cb31-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> urban_ontario, <span class="dt">fill =</span> <span class="st">"orange"</span>)</a></code></pre></div>
<p><img src="region_files/figure-html/unnamed-chunk-27-1.png" width="700"></p>
<p>Now to filter your observations to urban areas, the first step would be to get all the UTM squares which overlap these areas. We can do this collecting the UTM squares with <code><a href="../../reference/meta.html">meta_utm_squares()</a></code> and then filtering these to include only those that overlap these urban areas.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">utm_on &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/meta.html">meta_utm_squares</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(statprov_code <span class="op">==</span><span class="st"> "ON"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(<span class="dv">3347</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Transform to match urban CRS</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_join">st_join</a></span>(urban_ontario, <span class="dt">left =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>() <span class="co"># To omit duplicates of 1+ urban area on a given UTM Square</span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"></a>
<a class="sourceLine" id="cb32-7" data-line-number="7"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb32-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb32-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> ontario) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> utm_on, <span class="dt">fill =</span> <span class="st">"red"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> urban_ontario, <span class="dt">fill =</span> <span class="st">"blue"</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="region_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
<p>It’s a bit tricky to see exactly what’s going on, so let’s zoom in a bit.</p>
<p>However, it’s also a bit tricky to zoom when we’re using a non-lat/lon CRS because the units are unintuitive. So let’s specify the limits we want, then transform them in the CRS we’re using and use that to set our limits.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">zoom &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(<span class="dt">lon =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">81</span>, <span class="dv">-78</span>, <span class="dv">-81</span>, <span class="dv">-78</span>),</a>
<a class="sourceLine" id="cb33-2" data-line-number="2">                   <span class="dt">lat =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">43</span>, <span class="dv">43</span>, <span class="dv">45</span>, <span class="dv">45</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_as_sf">st_as_sf</a></span>(<span class="dt">coords =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(<span class="dv">3347</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_bbox">st_bbox</a></span>()</a>
<a class="sourceLine" id="cb33-6" data-line-number="6">zoom</a></code></pre></div>
<pre><code>##      xmin      ymin      xmax      ymax 
## 7067507.7  830951.5 7352759.4 1101349.9</code></pre>
<p>For convinience, we’ll use the <code><a href="https://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange()</a></code> function from the gridExtra to line up the figures side-by-side so we can get a really good look at what we’re doing.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb35-4" data-line-number="4"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> ontario) <span class="op">+</span></a>
<a class="sourceLine" id="cb35-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> urban_ontario, <span class="dt">fill =</span> <span class="st">"blue"</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb35-6" data-line-number="6"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">coord_sf</a></span>(<span class="dt">xlim =</span> zoom[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">3</span>)], <span class="dt">ylim =</span> zoom[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">4</span>)]),</a>
<a class="sourceLine" id="cb35-7" data-line-number="7">  <span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb35-8" data-line-number="8"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb35-9" data-line-number="9"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> ontario) <span class="op">+</span></a>
<a class="sourceLine" id="cb35-10" data-line-number="10"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> utm_on, <span class="dt">fill =</span> <span class="st">"red"</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb35-11" data-line-number="11"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> urban_ontario, <span class="dt">fill =</span> <span class="st">"blue"</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb35-12" data-line-number="12"><span class="st">    </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">coord_sf</a></span>(<span class="dt">xlim =</span> zoom[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">3</span>)], <span class="dt">ylim =</span> zoom[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">4</span>)]),</a>
<a class="sourceLine" id="cb35-13" data-line-number="13">  <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="region_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
<p>So now we can see that the <code>utm_squares</code> we’ve selected overlap all our urban areas. Now we can download the observations for all of these areas:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">obs &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/nc_data_dl.html">nc_data_dl</a></span>(<span class="dt">region =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">utm_squares =</span> utm_on<span class="op">$</span>utm_square))</a></code></pre></div>
<p>Finally, we do clip the resulting observations to the exact urban areas:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1">obs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_as_sf">st_as_sf</a></span>(obs, <span class="dt">coords =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="st">  </span><span class="kw">st_transfor</span>(<span class="dt">crs =</span> <span class="dv">3347</span>)</a>
<a class="sourceLine" id="cb37-3" data-line-number="3">  <span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_join">st_join</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(urban_ontario), <span class="dt">left =</span> <span class="st">"FALSE"</span>)</a>
<a class="sourceLine" id="cb37-4" data-line-number="4"></a>
<a class="sourceLine" id="cb37-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb37-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> ontario) <span class="op">+</span></a>
<a class="sourceLine" id="cb37-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> urban_ontario, <span class="dt">fill =</span> <span class="st">"blue"</span>, <span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb37-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> obs) <span class="op">+</span></a>
<a class="sourceLine" id="cb37-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">coord_sf</a></span>(<span class="dt">xlim =</span> zoom[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">3</span>)], <span class="dt">ylim =</span> zoom[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">2</span>,<span class="dv">4</span>)])</a></code></pre></div>
</div>
<div id="bounding-box" class="section level4">
<h4 class="hasAnchor">
<a href="#bounding-box" class="anchor"></a>Bounding Box</h4>
<p>In this example, we’ll gather all observations for Jasper National Park in Alberta, Canada.</p>
<p>First we’ll download and extract the shapefiles available from the <a href="https://www.albertaparks.ca/albertaparksca/library/downloadable-data-sets/">Alberta Parks</a> website.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">url &lt;-<span class="st"> "https://www.albertaparks.ca/media/2941843/parks_and_protected_areas_alberta.zip"</span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/download.file">download.file</a></span>(<span class="dt">url =</span> url)</a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/unzip">unzip</a></span>(<span class="st">"parks_and_protected_areas_alberta.zip"</span>)</a>
<a class="sourceLine" id="cb38-4" data-line-number="4"></a>
<a class="sourceLine" id="cb38-5" data-line-number="5">parks &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_read">st_read</a></span>(<span class="st">"Parks_Protected_Areas_Alberta.shp"</span>)</a></code></pre></div>
<pre><code>## Reading layer `Parks_Protected_Areas_Alberta' from data source `/home/steffi/Projects/Business/BSC/NatureCounts/naturecounts/vignettes/articles/region_files/Parks_Protected_Areas_Alberta.shp' using driver `ESRI Shapefile'
## Simple feature collection with 477 features and 17 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 170844.3 ymin: 5425575 xmax: 860845.9 ymax: 6659216
## epsg (SRID):    NA
## proj4string:    +proj=tmerc +lat_0=0 +lon_0=-115 +k=0.9992 +x_0=500000 +y_0=0 +datum=NAD83 +units=m +no_defs</code></pre>
<p>Now we’ll get a background map of Alberta and a spatial file of just Jasper.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">alberta &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/rnaturalearth/topics/ne_states">ne_states</a></span>(<span class="dt">country =</span> <span class="st">"Canada"</span>, <span class="dt">returnclass =</span> <span class="st">"sf"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(name <span class="op">==</span><span class="st"> "Alberta"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(<span class="dv">3347</span>)</a>
<a class="sourceLine" id="cb40-4" data-line-number="4"></a>
<a class="sourceLine" id="cb40-5" data-line-number="5">jasper &lt;-<span class="st"> </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(parks, NAME <span class="op">==</span><span class="st"> "Jasper"</span>)</a></code></pre></div>
<p>Let’s see what that all looks like.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> alberta) <span class="op">+</span></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> parks, <span class="dt">fill =</span> <span class="st">"lightyellow"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb41-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> jasper, <span class="dt">fill =</span> <span class="st">"orange"</span>)</a></code></pre></div>
<p><img src="region_files/figure-html/unnamed-chunk-37-1.png" width="700"></p>
<p>Using a bounding box is a good way to download observations only from the Jasper area. But remember that the bounding box coordinates used by <code><a href="../../reference/nc_data_dl.html">nc_data_dl()</a></code> are in lat/lon, so we’ll have to back transform.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">b &lt;-<span class="st"> </span>jasper <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(<span class="dv">4326</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb42-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_bbox">st_bbox</a></span>()</a>
<a class="sourceLine" id="cb42-4" data-line-number="4">b</a></code></pre></div>
<pre><code>##       xmin       ymin       xmax       ymax 
## -119.54484   52.12700 -116.79566   53.48118</code></pre>
<p>We can give this directly to our <code><a href="../../reference/nc_data_dl.html">nc_data_dl()</a></code> function.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">obs &lt;-<span class="st"> </span><span class="kw"><a href="../../reference/nc_data_dl.html">nc_data_dl</a></span>(<span class="dt">region =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">bbox =</span> b))</a></code></pre></div>
<p>Finally we clip the observations to the exact area of Jasper.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">obs &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_as_sf">st_as_sf</a></span>(obs, <span class="dt">coords =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"lon"</span>, <span class="st">"lat"</span>), <span class="dt">crs =</span> <span class="dv">4326</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_transform">st_transform</a></span>(<span class="dv">3347</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/sf/topics/st_join">st_join</a></span>(<span class="kw"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>(jasper), <span class="dt">left =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb45-4" data-line-number="4"></a>
<a class="sourceLine" id="cb45-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb45-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb45-7" data-line-number="7"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> jasper) <span class="op">+</span></a>
<a class="sourceLine" id="cb45-8" data-line-number="8"><span class="st">  </span><span class="kw"><a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="dt">data =</span> obs)</a></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#in-short">In short</a></li>
      <li><a href="#in-detail---codes">In Detail - Codes</a></li>
      <li><a href="#in-detail---exploring-regions">In Detail - Exploring regions</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Steffi LaZerte, Denis LePage.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
