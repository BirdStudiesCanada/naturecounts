% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/download.R
\name{nc_data_dl}
\alias{nc_data_dl}
\title{Download NatureCounts data records}
\usage{
nc_data_dl(collections = NULL, project_ids = NULL, species = NULL,
  years = NULL, doy = NULL, region = NULL, site_type = NULL,
  fields_set = "minimum", fields = NULL, username, request_id = NULL,
  sql_db = NULL, warn = TRUE, verbose = TRUE)
}
\arguments{
\item{collections}{Character vector. The collection codes from which to
download data. NULL (default) downloads data from all available collections}

\item{project_ids}{Character/Numeric vector. The \code{project id}s from which to
download data. First the collections associated with a \code{project_id} are
determined, and then data is downloaded for each collection. If both
\code{collections} and \code{project_ids} are supplied, they are combined.}

\item{species}{Numeric vector. Numeric species ids (see details)}

\item{years}{Numeric vector. The start/end years of data to download. Can use
NA for either start or end, or a single value to return data from a single
year.}

\item{doy}{Character/Numeric vector. The start/end day-of-year to download
(1-366 or dates that can be converted to day of year). Can use NA for
either start or end}

\item{region}{List. Named list with \emph{one} of the following options:
\code{country}, \code{statprov}, \code{subnational2}, \code{iba}, \code{bcr}, \code{utm_squares}, \code{bbox}.
See details}

\item{site_type}{Character vector. The type of site to return (e.g., \code{IBA}).}

\item{fields_set}{Character. Set of fields/columns to download. See details.}

\item{fields}{Character vector. If \code{fields_set = custom}, which
fields/columns to download. See details}

\item{username}{Character vector. Username for \url{http://naturecounts.ca}. If
provided, the user will be prompted for a password. If left NULL, only
public collections will be returned.}

\item{request_id}{Numeric. Specific request id to check or download.}

\item{sql_db}{Character vector. Name and location of SQLite database to
either create or add to}

\item{warn}{Logical. Interactive warning if request more than 1,000,000
records to download.}

\item{verbose}{Logical. Show messages?}
}
\value{
Data frame
}
\description{
Download data records from various collections filtered by various options.
In order to ease the load on the server, note that only \strong{three} of
\code{collections}/\code{project_ids}, \code{species}, \code{years}, \code{doy}, \code{region}, and
\code{site_type} can be used in any one request. See the vignette for filtering
your data after download for more options:
\code{vignette("filtering_data", package = "naturecounts")}.
}
\section{NatureCounts account}{

All public data is available without a username/password. However, to
access private/semi-public projects/collections you must \href{https://www.birdscanada.org/birdmon/default/register.jsp}{sign up} for a free
NatureCounts account and
\href{https://www.birdscanada.org/birdmon/default/projects.jsp}{register} for
the projects you'd like to access. See the \code{request_id} section for more
information.
}

\section{Species ids (\code{species})}{

Numeric species id codes can determined from the functions
\code{\link[=species_search]{species_search()}} or \code{\link[=species_code_search]{species_code_search()}}. See
also the \href{https://birdstudiescanada.github.io/naturecounts/articles/species-codes.html}{species codes}
for more information.
}

\section{Day of Year (\code{doy})}{

The format for day of year (\code{doy}) is fairly flexible and can be a whole
number between 1 and 366 or anything recognized by
\code{\link[lubridate]{lubridate-package}}'s \code{\link[lubridate]{ymd}()}
function. However, it must have the order of year, month, day. Note that
year is ignored when converting to day of year, except that it will result
in a 1 day offset for leap years.
}

\section{Regions (\code{region})}{

Regions are defined by codes reflecting the country, state/province,
subnational (level 2), Important Bird Areas (IBA), and Bird Conservation
Regions (BCR) (see \code{\link[=region_search]{region_search()}} for codes). They can also be defined
by providing specific UTM squares to download or a bounding box area which
specifys the min/max longitude and min/max latitude (\code{bbox}). See the
article on \href{http://BirdStudiesCanada.github.io/naturecounts/articles/region-codes.html}{regional filters}
for more information.
}

\section{Data Fields/Columns (\code{fields_set} and \code{fields})}{

By default data is downloaded with the \code{minimum} set of fields/columns.
However, for more advanced applications, users may wish to specify which
fields/columns to return. The Bird Monitoring Data Exchange (BMDE) schema
keeps track of variables used to augment observation data. There are
different versions reflecting different collections of variables which can
be specified for download in one of four ways:
\enumerate{
\item \code{fields_set} can be a specific shorthand reflecting a BMDE version:
\code{core}, \code{extended} or \code{minimum} (default). See \code{\link[=meta_bmde_versions]{meta_bmde_versions()}} to see
which BMDE version the shorthand refers to.
\item \code{fields_set} can be \code{default} which uses the default BMDE version for a
particular collection (note that if you download more than one collection,
the field sets will expand to cover all fields/columns in the combined
collections)
\item \code{fields_set} can be the exact BMDE version. See \code{\link[=meta_bmde_versions]{meta_bmde_versions()}}
for options.
\item \code{fields_set} can be \code{custom} and the \code{fields} argument can be a
character vector specifying the exact fields/columns to return. See
\code{\link[=meta_bmde_fields]{meta_bmde_fields()}}) for potential \code{fields} values.
}

Note that in all cases there are a set of fields/columns that are \emph{always}
returned, no matter what \code{fields_set} is used.
}

\section{\code{request_id}'s}{

There are two types of data requests: ones made through the api (i.e. this
\code{naturecounts} R package) and those made through the online \href{https://www.birdscanada.org/birdmon/default/searchquery.jsp}{Web Request Form}. Each
request generates a request id which identifies the filter set and
collections requested.

Requests made through this package via the \code{\link[=nc_data_dl]{nc_data_dl()}} function only
return data the user has access to. If data was successfully downloaded, the
user can see the request details with the \code{\link[=nc_requests]{nc_requests()}} function.

Requests made through the online \href{https://www.birdscanada.org/birdmon/default/searchquery.jsp}{Web Request Form} may
include collections to which the user does not have access. \code{\link[=nc_requests]{nc_requests()}}
will list the requests along with the approval status (either 'approved' or
'pending').

Any approved request id can be downloaded by supplying the \code{request_id} to
\code{\link[=nc_data_dl]{nc_data_dl()}} (e.g., \code{nc_data_dl(request_id = 152000, username = "USER")}).
}

\examples{
# All observations part of the RCBIOTABASE collection
rcbio <- nc_data_dl(collections = "RCBIOTABASE", username = "sample")

\donttest{# All observations part of project_id 1042 accessible by "sample"
p1042 <- nc_data_dl(project_ids = 1042, username = "sample")}

# Black-capped chickadees from RCBIOTABASE collection in 2010
species_search("black-capped chickadee") # Find the species_id
bcch <- nc_data_dl(collection = "RCBIOTABASE", species = 14280,
                   years = 2010, username = "sample")

# All bcch observations since 2015 accessible to user "sample"
bcch <- nc_data_dl(species = 14280, years = c(2015, NA), username = "sample")

bcch <- nc_data_dl(species = 14280, doy = c(200, 300), username = "sample")

bcch <- nc_data_dl(species = 14280, username = "sample",
                   region = list(bbox = c(left = -145, bottom = 45,
                                          right = -100, top = 60)))

# All moose observations with public access
species_search("moose")
moose <- nc_data_dl(species = 133990, username = "sample")

# Different fields/columns
moose <- nc_data_dl(species = 133990, fields_set = "core",
                    username = "sample")

moose <- nc_data_dl(species = 133990, fields_set = "custom",
                    fields = c("Locality", "AllSpeciesReported"),
                    username = "sample")

\dontrun{
# All collections by request id
my_data <- nc_data_dl(request_id = 000000, username = "USER")

# Specific collection by request id
my_data <- nc_data_dl(collections = "ABATLAS1",
                      request_id = 000000, username = "USER")
}

}
